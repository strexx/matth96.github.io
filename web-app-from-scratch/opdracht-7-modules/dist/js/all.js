"use strict";var weatherApp=weatherApp||{};weatherApp.start=function(){return{init:function(){weatherApp.localStorage.init(),weatherApp.webWorker.init(),weatherApp.routes.init(),weatherApp.support.init()}}}(),weatherApp.data=function(){function e(e){var t=a[0]+e+a[1]+r;return t}function t(e){var t=n[0]+e+n[1]+r;return t}var r="7aa0e92a8b7be8ed7e420e33de310e0e",a=["http://api.openweathermap.org/data/2.5/weather?q=","&units=metric&appid="],n=["http://api.openweathermap.org/data/2.5/find?q=","&type=like&mode=json&appid=","&units=metric&appid="];return{WeatherUrl:e,SearchUrl:t}}(),weatherApp.localStorage=function(){function e(){n.forEach(function(e,t){var r=localStorage.getItem(e);(null===r||void 0===r)&&localStorage.setItem(e,"[]")}),(null===o||void 0===o)&&localStorage.setItem("savedCitys","[]")}function t(e){var t=localStorage.getItem(e);return JSON.parse(t)}function r(e,r){var a=t(e),n=_.contains(a,r);if(n===!1){a.push(r);var o=JSON.stringify(a);localStorage.setItem("savedCitys",o)}else weatherApp.ux.showErr("You already add this one.")}function a(e,t){var r=o.indexOf(e);if(-1!==r){o.splice(r,1);var a=JSON.stringify(o);localStorage.setItem("savedCitys",a),document.location.reload(!0)}else weatherApp.ux.showErr("Sorry, your city isn't deleted.Try again.")}var n=["home","citys","city","search","searchresults"],o=t("savedCitys");return{init:e,templates:n,get:t,add:r,remove:a}}(),weatherApp.webWorker=function(){function e(){var e=new Worker("./dist/js/templateWorker.js");e.addEventListener("message",function(e){"savedCitys"===e.data.name||void 0===e.data.name?console.log("Not in savedCitys"):localStorage.setItem(e.data.name,e.data.template)},!1),r(e)}function t(){var e=[];return weatherApp.localStorage.templates.forEach(function(t,r){var a=JSON.parse(localStorage.getItem(t)).length;0>=a&&e.push(t)}),e}function r(e){e.postMessage({cmd:"start",msg:"hoi",templates:t()})}return{init:e}}(),weatherApp.get=function(){function e(e){return document.querySelector(e)}function t(e){return document.querySelectorAll(e)}function r(e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e),a.onloadstart=function(){weatherApp.render.loading(!0)},a.onloadend=function(){weatherApp.render.loading(!0)},a.onload=function(){200==a.status?(weatherApp.render.loading(!1),t(a.responseText)):(r(new Error("request failed!")),weatherApp.ux.showErr("There went something wrong"))},a.send()})}return{one:e,all:t,data:r}}(),weatherApp.page=function(){function e(){weatherApp.render.template("#target",n)}function t(){var e=function(){var e=weatherApp.get.one("#search");e.addEventListener("input",function(){var t=weatherApp.data.SearchUrl(e.value);weatherApp.get.data(t).then(function(e){var t=JSON.parse(e).list,r=_.map(t,function(e){return e.attachedName=e.name.replace(/ /g,"-").toLowerCase(),e});if(weatherApp.get.one(".in-nl").checked===!0){var a=_.filter(r,function(e,t){return"NL"===e.sys.country});return a}var a=r;return a}).then(function(e){weatherApp.render.template("#searchresults",o,e),weatherApp.get.one(".searchlist").addEventListener("click",function(e){e.target&&"LI"==e.target.nodeName&&(weatherApp.localStorage.add("savedCitys",e.target.id),window.location="#/citys")})})["catch"](function(e){console.error(e)})})};weatherApp.render.template("#target",i),e()}function r(){var e=[],t=weatherApp.localStorage.get("savedCitys");t.length<=0?(window.location="#/search",weatherApp.ux.showErr("Sorry, there' nothing here, please add a city.")):t.forEach(function(r){var a=weatherApp.data.WeatherUrl(r),n=function(){var e=weatherApp.get.one(".citys");e.addEventListener("click",function(e){var t=e.target.id.toLowerCase();weatherApp.localStorage.remove(t,p)})};weatherApp.get.data(a).then(function(e){var t=JSON.parse(e);return t}).then(function(r){e.push({cityName:r.name,cityNameUrl:r.name,description:r.weather[0].description,temp:r.main.temp}),e.length===t.length&&(weatherApp.render.template("#target",p,e),weatherApp.ux.init(),n())})["catch"](function(e){console.error(e),weatherApp.ux.showErr("There was a error :(")})})}function a(e){var t=weatherApp.data.WeatherUrl(e);weatherApp.get.data(t).then(function(e){var t=JSON.parse(e);return t}).then(function(e){var t={cityName:e.name,description:e.weather[0].description,minTemp:e.main.temp_min,maxTemp:e.main.temp_max,temp:e.main.temp,clouds:e.clouds.all,wind:e.wind.speed};weatherApp.render.template("#target",c,t)})["catch"](function(e){console.error(e),weatherApp.ux.showErr("There was a error :(")})}var n=weatherApp.localStorage.get("home"),o=weatherApp.localStorage.get("searchresults"),i=weatherApp.localStorage.get("search"),p=weatherApp.localStorage.get("citys"),c=weatherApp.localStorage.get("city");return{home:e,search:t,citys:r,city:a}}(),weatherApp.render=function(){function e(e,t,r){null===t||t===[]||0===t.length?setTimeout(function(){document.location.reload(!0)},200):weatherApp.get.one(e).innerHTML=Mustache.render(t,{data:r})}function t(e){e?weatherApp.get.one(".loading").classList.remove("disabled"):setTimeout(function(){weatherApp.get.one(".loading").classList.add("disabled")},300)}return{template:e,loading:t}}(),weatherApp.ux=function(){function e(){var e=weatherApp.get.one(".citys"),a=new Hammer(e);t(a),r(a)}function t(e){e.on("swipeleft",function(e){var t=weatherApp.get.one("."+e.target.id);t.style.width="100px"})}function r(e){e.on("swiperight",function(e){var t=weatherApp.get.one("."+e.target.id);t.style.width="0px"})}function a(e){n.classList.add("show-error"),n.innerHTML=e,setTimeout(function(){n.classList.remove("show-error"),n.innerHTML=""},4e3)}var n=weatherApp.get.one(".error");return{init:e,showErr:a}}(),weatherApp.routes=function(){function e(){var e=Router(a);e.init()}function t(){(void 0===location.hash||""===location.hash)&&(window.location="#/home")}function r(){e(),t(),weatherApp.render.loading(!1)}var a={"/home":weatherApp.page.home,"/search":weatherApp.page.search,"/citys":weatherApp.page.citys,"/city/:city":weatherApp.page.city};return{init:r}}(),weatherApp.support=function(){function e(){t(),r()}function t(){"onhashchange"in window?console.log("onhashchange is supported"):weatherApp.ux.showErr("The browser isn't supporting this app :(")}function r(){return navigator.onLine?!0:(weatherApp.ux.showErr("Your are offline :("),!1)}return{init:e}}(),weatherApp.start.init();